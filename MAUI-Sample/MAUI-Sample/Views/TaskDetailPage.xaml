<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MAUI_Sample.ViewModels"
             xmlns:model="clr-namespace:MAUI_Sample.Models"
             x:Class="MAUI_Sample.Views.TaskDetailPage"
             x:DataType="vm:TaskDetailViewModel"
             Title="{Binding Title}">

    <ScrollView>
        <StackLayout Padding="20" Spacing="15">
            <ActivityIndicator IsRunning="{Binding IsBusy}" 
                               IsVisible="{Binding IsBusy}"
                               HorizontalOptions="Center" />

            <Grid IsVisible="{Binding IsNotBusy}" RowDefinitions="Auto,*">
                <StackLayout Grid.Row="0" Spacing="10">
                    <Label Text="Informations de la tâche" FontSize="Large" FontAttributes="Bold" />
                    <BoxView HeightRequest="1" Color="LightGray" />

                    <Label Text="ID:" FontAttributes="Bold" />
                    <Label Text="{Binding Task.Id}" />

                    <Label Text="Statut:" FontAttributes="Bold" />
                    <Frame BorderColor="LightGray" Padding="5" CornerRadius="5">
                        <Label Text="{Binding Task.Status}" HorizontalOptions="Center" />
                    </Frame>

                    <Label Text="Date de création:" FontAttributes="Bold" />
                    <Label Text="{Binding Task.CreatedAt, StringFormat='{0:dd/MM/yyyy HH:mm}'}" />

                    <Label Text="Dernière mise à jour:" FontAttributes="Bold" />
                    <Label Text="{Binding Task.UpdatedAt, StringFormat='{0:dd/MM/yyyy HH:mm}'}" />
                </StackLayout>

                <StackLayout Grid.Row="1" Spacing="10" Margin="0,20,0,0">
                    <Label Text="Modifier la tâche" FontSize="Large" FontAttributes="Bold" />
                    <BoxView HeightRequest="1" Color="LightGray" />

                    <Label Text="Titre:" FontAttributes="Bold" />
                    <Entry Text="{Binding TaskEdit.Title}" />

                    <Label Text="Description:" FontAttributes="Bold" />
                    <Editor Text="{Binding TaskEdit.Description}" HeightRequest="100" />

                    <Label Text="Priorité:" FontAttributes="Bold" />
                    <Picker ItemsSource="{Binding PriorityOptions}" 
                            SelectedItem="{Binding TaskEdit.Priority}" />

                    <Label Text="Date d'échéance:" FontAttributes="Bold" />
                    <DatePicker Date="{Binding TaskEdit.DueDate}" />

                    <Button Text="Mettre à jour" 
                            Command="{Binding UpdateTaskCommand}" 
                            BackgroundColor="Green"
                            TextColor="White"
                            Margin="0,10,0,0"/>

                    <Label Text="Changer le statut:" FontAttributes="Bold" Margin="0,20,0,0" />
                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                        <Button Text="À faire" 
                                Command="{Binding UpdateStatusCommand}" 
                                CommandParameter="todo"
                                WidthRequest="100" />

                        <Button Text="En cours" 
                                Command="{Binding UpdateStatusCommand}" 
                                CommandParameter="in_progress"
                                WidthRequest="100" />

                        <Button Text="Terminée" 
                                Command="{Binding UpdateStatusCommand}" 
                                CommandParameter="done"
                                WidthRequest="100" />
                    </HorizontalStackLayout>
                </StackLayout>
            </Grid>
        </StackLayout>
    </ScrollView>
</ContentPage>